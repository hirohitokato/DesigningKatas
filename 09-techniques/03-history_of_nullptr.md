---
marp: true
math: mathjax
theme: katas
title: "nullポインタの歴史"
---
<!-- 
size: 16:9
paginate: true
-->
<!-- header: 勉強会# ― エンジニアとしての解像度を高めるための勉強会-->

# nullポインタの歴史

<!-- この概念を採用したことによって10億ドルの損失を世界中に生んだと言われる厄災とでもいうべき存在 -->

---

## nullポインタとは

何のオブジェクトも指していないことを表す特別なポインタの値。
（リアルモードで動くプログラムを除き）不正なアドレスとして扱われ、nullポインタに対して操作を行おうとするとメモリアクセス違反でアボートする。

プログラミング言語「Algol 60」で初めて登場した

<!-- 1960年に作られたプログラミング言語。ペルセウス座の恒星で2等星もアルゴルと名付けられているが、意味はアラビア語で「食屍鬼(グール)の頭」を意味する -->
<!-- https://www.infoq.com/presentations/Null-References-The-Billion-Dollar-Mistake-Tony-Hoare/ -->

---

## nullポインタにより落ちる例(C++)

```cpp
some_flag = false;

...

SomeClass* a = nullptr;
if (some_flag) {
	a = new SomeClass(...);
}

a->run(); // ABORT!!
```

---

## Algol 60のサンプルコード (階乗(n!)を求める)

```algol
begin
	comment Algol 60で階乗を求めるプログラム;
	integer procedure factorial(n); integer n;
	begin
		integer i,fact;
		fact:=1;
		for i:=2 step 1 until n do
			fact:=fact*i;
		factorial:=fact
	end;
	integer i;
	for i:=1 step 1 until 10 do outinteger(1,factorial(i));
	outstring(1,"\n")
end
```

---
## 語源

ラテン語の『nullus』に由来。「無」を意味する。

>>> Swift, Objective-Cなどで出てくる`nil`もラテン語の nihil の短縮形に由来する

<!-- ラテン語の意味は虚無。冷めたり暗い考えに陥りがちな人を表す「ニヒル」と同じ。 -->
---

## NULLポインタは何を引き起こすか

1. 予期しない動作
1. デバッグの難しさ
1. セキュリティリスクの増加
1. パフォーマンス低下
1. コードの可読性と保守性の低下

<!-- 
ヌルポインタ（Null Pointer）が多くの損害を与える理由はいくつかあります。以下の点が特に重要です：

1. 予期しない動作: ヌルポインタを参照すると、プログラムが予期しない動作をすることがあります。これは、プログラムがクラッシュしたり、データが破損したりする原因となります。
2. デバッグの難しさ: ヌルポインタの問題は、デバッグが非常に難しいことがあります。特に大規模なコードベースでは、どこでヌルポインタが発生したのかを特定するのが困難です。
3. セキュリティリスク: ヌルポインタの参照は、セキュリティホールを生むことがあります。攻撃者がこれを悪用して、任意のコードを実行したり、システムにアクセスしたりする可能性があります。
4. パフォーマンスの低下: ヌルポインタのチェックを頻繁に行う必要があるため、プログラムのパフォーマンスが低下することがあります。これは特にリアルタイムシステムや高パフォーマンスが求められるアプリケーションで問題となります。
5. コードの可読性と保守性: ヌルポインタのチェックが多いコードは、可読性が低く、保守が難しくなります。これにより、開発者がコードを理解しにくくなり、バグが増える可能性があります。

これらの理由から、ヌルポインタは多くの損害を与える可能性があり、プログラミングにおいては注意が必要です。
-->
---

## NULLポインタの何が問題か

- オブジェクトが存在するかどうかを実行時にしか判断できない
    - 「この値はNULLポインタになるかもしれない」を型にすればよかった
- C言語で0をNULLポインタにしたこと
    - 言語としてキーワードにするべきだった(C++では`nullptr`がある)

<!-- C++、Java、Javascript、最近までのC#など、C系言語では大概、どのポインタ・オブジェクト参照もnullにできます。つまり、必須パラメータの有無を、ランタイムで確認するまでは保証できないので、多くのクラッシュの原因になります。
 対処法としては、MLやHaskell、C# 8などでみられる、nullableやオプション型などで、型を指定するときのデフォルトをnull非許容にすることです。
これによって、必須項目がすべて存在することを型システムが確認してくれるので、設計も少し楽になります。 -->

<!-- C言語で、空ポインターをNULLマクロで表したこと。キーワードにすべきでした。

マクロの展開が0になることがあり（特にc++では）空ポインターは0だという誤解が発生しました。実際は仕様では、ソースで0と書いてあっても実行可能プログラム内での内部値は0（すべてのビットが0）とは限りません。処理系依存です。とても分かりにくい仕様になってしまいました。

マクロでなくキーワードにして「実際の値は処理系依存だ」と宣言してしまえば「処理系依存なら仕方がない」と皆あきらめるので、不要な混乱をもたらさなかったでしょう。

c++ではnullptr というキーワードができましたが、既に混乱は起こった後だったので手遅れかもしれません。 -->

---

## NULLポインタ誕生の瞬間

1965年にALGOL W言語を開発する際

> **「実装が簡単であったから」「(簡単という)誘惑に抗えなかったから」**

という理由で実装された。本来はコンパイル時からヌル許容/非許容を判断したかった


>>> Tony Hoareによる講演「[Null References: The Billion Dollar Mistake](https://www.infoq.com/presentations/Null-References-The-Billion-Dollar-Mistake-Tony-Hoare/)」より

<!-- アントニー・リチャード・ホーア（トニー・ホーア）はイギリスの計算機科学者。クイックソートを考案した人 -->
<!-- それは10億ドルにも相当する私の誤りだ。null参照を発明したのは1965年のことだった。当時、私はオブジェクト指向言語 (ALGOL W) における参照のための包括的型システムを設計していた。目標は、コンパイラでの自動チェックで全ての参照が完全に安全であることを保証することだった。しかし、私は単にそれが容易だというだけで、無効な参照を含める誘惑に抵抗できなかった。これは、後に数え切れない過ち、脆弱性、システムクラッシュを引き起こし、過去40年間で10億ドル相当の苦痛と損害を引き起こしたとみられる。 -->

<!-- ちなみに -->
<!-- ## ヌル文字$^1$ '`\0`'

- C言語やその派生言語や各種データフォーマットで文字列やデータの終端を表す制御文字

元々NOP(No Operation)と似た意味で用いられていた。

>>> 1:ヌル終端文字とも言う

--- -->