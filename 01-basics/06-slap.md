---
marp: true
theme: katas
---
<!-- 
size: 16:9
paginate: true
-->
<!-- header: 勉強会#-->
<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
  mermaid.initialize({ startOnLoad: true });
</script>

# SLAP

![bg](assets/slap.jpg)

---

# SLAP$^1$

_(Single Level of Abstraction Principle)_

── 抽象度統一の原則

>>> 1:Robert C. Martin著『Clean Code』(2009)が初出。SOLIDを提唱するなど「ボブおじさん（Uncle Bob）」としてソフトウェア設計の界隈では超有名。

---

## SLAPとは

関数やレイヤーを抽象レベルに沿って抽出すること

* ある関数の中で呼ぶ処理は同じ抽象レベルに揃えること* 抽象度の異なるAPIを同じグループで提供しないこと
* 複合関数とロジック関数とを明確に分けること

SLAPが守られていると…

* **読みやすく、理解しやすくなる**
* **変更に強くなり、保守性が上がる**

---

## 例
```py
def high_level():
    middle_level1()
    middle_level2()

def middle_level1():
    low_level1()
    low_level2()

def middle_level3():
    low_level3()

def low_level1():
    # 具体的な処理...
def low_level2():
    # 具体的な処理...
def low_level3():
    # 具体的な処理...
```

---

## 高レベル〜低レベル

※段階の度合いは３つでなくとも良い。規模によっては２段階程度にもなるし、

### 高レベル
* ビジネスロジックやユースケースなど、対象のドメイン(モジュール/クラス/関数)が行うシーケンスを記述
    * 「ここではつまり〜をする」が一望できるレベル
* 「何をするか」が大きくまとめられているイメージ

---

## 高レベル〜低レベル

### 中レベル

* 高レベルよりも一段階抽象度が低い処理
* 分割されたモジュールにおけるメインシーケンス
* さらに下のレベルに分けたほうがいい場合、このレベルも複合関数として実装する

---

### 低レベル
* 分割する必要のなくなった具体的な処理
    * ロジック関数とも
* ドライバーなどの低レイヤーの処理
* ライブラリやデータベースのような外部機能
* 機種ごとに異なる処理
* アーキテクチャによってはUIや外部公開API$^1$なども含まれる

>>> クリーンアーキテクチャにおいてはUIやモジュールの外部インターフェイスも低レベル相当になる

---

## 複合関数とロジック関数

### 複合関数

より低いレベルの他の関数を組み合わせて呼ぶのみで、自分自身は判断や実際の処理を行わない関数。

```py
def purchase_usecase(a, b):
    c = validate(a)
    d = get_item(a, c)
      :
```

---
## 複合関数とロジック関数

### ロジック関数

実際の処理を書く関数。単一の役割を担うのみで、複数の機能は持たない

ツリー構造$^1$における

>>> フォルダとファイルのようなものをイメージすると良い

---

## 注意点

* コードを短くすることがSLAPの目的ではない
    * 複合関数とロジック関数の分割
    * ユースケースと機種依存処理の分割
