
* SOLID
    * Dにはハリウッドの原則
    * 最終的な連鎖関係にも言及する SRP→ISP→{DIP&LSP}→OCP
        1. SRP: 分割
        2. ISP: 使っていないものへの依存を回避
        3. DIP: 依存関係の方向を整理
        4. LSP: パーツが交換可能
        5. OCP: コード追加のみで機能拡張できる

---
<!-- インターフェイス分離の原則によって何が説明できると思いますか？（質問）
そうです。人間のエゴ、あるいは悲しい性(サガ)ですね。 -->

# SOLID #4 インターフェイス分離の原則
_Interface Segregation Principle_

> ### クライアントに、 クライアントが利用しないメソッドへの依存を強制してはならない
 
<!-- あるインターフェイスを用意するときに、仮想メソッドに複数の役割を詰め込まない。 -->

---

### 4.1. ISPの例
 
アプリからSMS送信をできるようにするために、
 
「いろんなSMSにも対応できるよう抽象インターフェイスを用意しておけば拡張にも対応しやすいね！」
 
と考え作ったのが次のコード。
 
```cs
// ❌
interface IMessageCommunicator {
    void send(String msg); // 送信だけでなく
    Task waitReceive();    // 受信機能もサービスによってはあるよね？
}
 
class LINEMessageSender: IMessageCommunicator {
    void send(String msg) { … }
    Task waitReceive() { … } ← 要らないのに実装しないとコンパイルエラー…
}
 
var sender = new LINEMessageSender();
// ライブラリ利用者「senderにはwaitReceive()もあるけどどういう意味？🤔」
```
 
上だと送信機能だけをサブクラスで実装できなくなり、使わないはずの受信機能までダミーで実装する事態になっていてヤバい。
 
### 4.2. どうしたらいい？
単一責任の原則(SRP)にも反しているので、下のように役割を分けることで使う側も勘違いなどのミスが減る。
 
```cs
// ⭕
interface IMessageSender {
    void send(String msg);
}
interface IMessageReceiver {
    void send(String msg);
    Task waitReceive();
}
class LINEMessageSender: IMessageSender {
    void send(String msg) { … } ← 必要なものだけ実装できる
}
```

---

![](../02-practical/assets/04-isp-swiftint.png)

>>> swiftdoc.orgよりSwift 3.1時代のInt型

---

## まとめ


---

## ISPはどう使う？
 
* **設計時**：クラス設計で単一責任の原則を守り、複数の機能を詰め込まない
* **違反の臭い**：(提供側)関係ないメソッドまで実装することを強いられている / (使用側)どのメソッドを使えばいいのか分からない
* **リファクタリング**：インターフェイスの粒度を役割ごとに分ける
 
---
<!-- 三枚舌外交
第一次世界大戦を有利に戦うため行い、中東の火種をつくったイギリスの秘密外交

https://solver-story.com/?p=1776

1. 第一次世界大戦でイギリスはオスマン帝国(トルコ)と敵対
    * 三国同盟{イギリス/フランス/ロシア} vs. 三国協商{ドイツ/オーストリア/イタリア+オスマン帝国}
2. イギリスはアラブ人(トルコ国内で反乱を促す)、ユダヤ人(資金援助)の協力を得ようとした
3. それぞれに秘密外交で矛盾した約束
    * アラブ人に… 旧トルコ領にアラブ人独立国家の建設を約束(1915年「フセイン＝マクマホン協定」)
    * ユダヤ人に… パレスチナにユダヤ人国家の建設を認める(1917年「バルフォア宣言」)
    * フランス・ロシアに… 旧トルコ領は我々だけで分割しよう(1916年「サイクス・ピコ協定」)
    * （アラブ/ユダヤに国を作ると言っておきながら最終的には自分たちのものにしようとしていた）
4. 大戦後、旧トルコ領の一部を英仏が委任統治
    * 両国の利害のみで中等を分割
    * そのまま各国が独立したため民族や宗教の対立が残った
* 第２次大戦後、英国からパレスチナ問題を丸投げされた国連はパレスチナ分割を決議
    * 米国の意向で、少数派のユダヤ人に約６割、アラブ人に約４割を割り当て、宗教対立の火種となる聖地エルサレムは国際管理とした
    * 決議に基づいて建国したイスラエルと、認めないアラブの間で中東戦争が発生
        * 勝利したイスラエルはエルサレム西側を領有し、後に東側も実効支配
        * 土地を追われた多くのパレスチナ人は難民となり、紛争は今もなお -->